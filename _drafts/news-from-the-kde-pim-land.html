---
layout: post
title: News from the KDE PIM land
date: 
type: post
parent_id: '0'
published: false
password: ''
status: draft
categories: []
tags: []
meta:
  _edit_last: '1'
author:
  login: dvratil
  email: me@dvratil.cz
  display_name: Dan Vrátil
  first_name: Daniel
  last_name: Vrátil
---
<p>Some overview of recent changes and improvements in KDE PIM, mostly Akonadi. It's been a while again since I wrote anything, so here we go.</p>
<p>&nbsp;</p>
<h2>Don't write, generate!</h2>
<p>Inspired by Jos' <a href="https://conf.qtcon.org/en/qtcon/public/events/416">talk about generated IO code</a> from QtCon I started working on a custom generator of our Protocol implementation. I started already back in August, but only got back to it on the KDE PIM sprint in Toulouse earlier this month, and finally merged it couple days ago. The Protocol is the, uhm, protocol, that Akonadi clients use to talk to the Akonadi Server and vice versa. We changed to binary protocol last year and since then the serialization and deserialization code have been written manually. Over 12k lines of hand-written code are a pain to read, maintain and modify - and any change to the Protocol usually required careful changes in several places. In such situation, it is very easy to make a mistake. So I decided to instead define the Protocol in an XML file and generate the C++ code from that. We already do that for our database schema and ORM using XSLT. XSLT, however, is an immense pain to write and I would probably end up with 12k lines of unmaintainable XSLT code to generate 12k lines of unmaintainable C++ code :-). So instead I just wrote my own generator that parses the XML (using QXmlStreamReader), creates an in-memory node tree and then traverses the tree and generates C++ code.</p>
<p>I also changed how we internally use the Protocol objects, which should give us a very little speed boost (on top of the immense speed boost of the binary protocol itself).</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
