ErrorDocument 404 /404.html

RewriteEngine On
RewriteBase /

# Allow existing files and directories ight awawy
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.*)$ - [L]

# Redirect old nested Wordpress categories to their new URLs
RewriteRule ^category/kde/akonadi(.*)$ /category/akonadi$1 [L]
RewriteRule ^category/kde/telepathy(.*)$ /category/telepathy$1 [L]
RewriteRule ^category/kde/akonadi-google(.*)$ /category/akonadi-google$1 [L]
RewriteRule ^category/gnome/evolution(.*)$ /category/evolution/$1 [L]

# Don't rewrite URL if it already ends with .html
RewriteRule ^(.*).html$ - [L]

# If the path does not end with "/", redirect to it
# (this is needed for ISSO to correctly detect URLs)
RewriteCond %{REQUEST_URI} !^(.*)/$
RewriteRule ^(.*)$ $1/ [R=301,L]

# If path ends with "/", replace the slash with .html
RewriteCond %{REQUEST_URI} ^(.*)/$
RewriteRule ^(.*)/$ $1.html [L]

RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ $1.html [L]
