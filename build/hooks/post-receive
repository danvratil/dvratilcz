SRV_DIR=/srv/http/www/d/dvratil.cz/www.dvratil.cz

_checkout_dir=$(mktemp -d)

git clone -b master --depth 1 --recursive ${GIT_DIR} ${_checkout_dir}
pushd ${_checkout_dir}

sudo docker run \
        --rm \
        --net host \
        -v $_checkout_dir:/srv/jekyll \
        -v ${SRV_DIR}:/srv/jekyll/_site \
        -e JEKYLL_UID=$(id -u) \
        -e JEKYLL_GID=$(id -g) \
        jekyll/jekyll \
        jekyll build

sudo chown -R apache:apache ${SRV_DIR}

popd
rm -rf ${_checkout_dir}

